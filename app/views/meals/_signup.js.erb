$(document).ready(function(){
  var MEAL_CLASS = "meal";
  $("#create-meal-form").hide();
  $("#signup-meal-form").hide();
  //EVENT BINDINGS  
  $(".calendar").click(function(event){
    $("#create-meal-form").hide();
    $("#signup-meal-form").hide();
    var $target = $(event.target);
    $(".alert-block").fadeIn();
    if ($target.attr('class').indexOf(MEAL_CLASS) > -1){
      //selected a meal
      $("#signup-meal-form").fadeIn();
      //make an ajax call to find out who signed up on that date
      $('#signup-date-display').html($target.attr('data-date'));
      $('#signup-date-param').val($target.attr('data-date'));
      $("#signup-meal-form").fadeIn();

      $.ajax({
        type: "POST",
        dataType: "html",
        url: '<%= get_attendence_meal_path %>',
        data: { "date": $target.attr('data-date')},
        success: function(data){
          $('#fill-in-form-join').html(data);
        },
        error: function(){
          alert("Cannot sign up for meal!");
        }
      });

    } else {
      $("#create-meal-form").modal();
      var parts = $target.attr('data-date').split("-");
      var dt = new Date(parseInt(parts[0], 10), // year
                  parseInt(parts[1], 10) - 1, // month
                  parseInt(parts[2], 10)); // day
      $("#datepicker").datepicker("setDate", dt );

    }
  });

  //Form submits
  $("create").submit(function(event){
    //make an ajax call to the server to create a meal on that date.
    $.ajax({url: "create",
          data: {type: '<%= params[:type] %>'},
          type: "POST"});
  });
});



